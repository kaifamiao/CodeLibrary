
## è§£æ³• 1:æš´åŠ›æ³•

æ¯æ¬¡å–å‡ºä¸­ä½æ•°çš„æ—¶å€™ï¼Œéƒ½å…ˆå°†æ‰€æœ‰å…ƒç´ è¿›è¡Œæ’åºï¼Œç„¶åå†è®¡ç®—ä¸­ä½æ•°ã€‚ä»£ç å¦‚ä¸‹ï¼š

```javascript
// åŸæ–‡åœ°å€ï¼šhttps://xxoo521.com/2020-02-27-find-median-from-data-stream/

var MedianFinder = function() {
    this.data = [];
};

MedianFinder.prototype.addNum = function(num) {
    this.data.push(num);
};

MedianFinder.prototype.findMedian = function() {
    const length = this.data.length;
    if (!length) {
        return null;
    }
    this.data.sort((a, b) => a - b);

    const mid = Math.floor((length - 1) / 2);
    if (length % 2) {
        return this.data[mid];
    }
    return (this.data[mid] + this.data[mid + 1]) / 2;
};
```

ä¹Ÿå¯ä»¥åœ¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ç›´æ¥æ’åºã€‚æ—¶é—´å¤æ‚åº¦ä¸€æ ·ï¼Œå‡æ˜¯$O(NlogN)$ï¼Œ**æ— æ³• ac**ã€‚

## è§£æ³• 2: äºŒåˆ†æŸ¥æ‰¾

å…¶å®ä¸éœ€è¦æ¯æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œéƒ½å¯¹å…¨éƒ¨å…ƒç´ é‡æ–°æ’åºã€‚å¦‚æœä¹‹å‰ä¸€ç›´ä¿è¯å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆæ·»åŠ æ–°å…ƒç´ çš„æ—¶å€™ï¼Œåªéœ€è¦å°†å…ƒç´ æ’å…¥åˆ°æ­£ç¡®ä½ç½®å³å¯ï¼ŒæŸ¥æ‰¾æ­£ç¡®ä½ç½®å¯ä»¥é€šè¿‡ã€ŒäºŒåˆ†æœç´¢ã€æ¥å®Œæˆã€‚

ä¸ºäº†ä¿è¯ä¹‹å‰çš„å…ƒç´ æœ‰åºï¼Œé’ˆå¯¹æ¯ä¸ªæ–°æ·»åŠ çš„å…ƒç´ éƒ½å°†å…¶æ”¾å…¥æ­£ç¡®ä½ç½®ã€‚

ä»£ç å®ç°å¦‚ä¸‹ï¼š

```javascript
// acåœ°å€ï¼šhttps://leetcode-cn.com/problems/find-median-from-data-stream/
// åŸæ–‡åœ°å€ï¼šhttps://xxoo521.com/2020-02-27-find-median-from-data-stream/

var MedianFinder = function() {
    this.data = [];
};

MedianFinder.prototype.addNum = function(num) {
    if (!this.data.length) {
        this.data.push(num);
        return;
    }

    let left = 0,
        right = this.data.length - 1;
    while (left <= right) {
        let mid = Math.floor((left + right) / 2);
        if (this.data[mid] === num) {
            this.data.splice(mid, 0, num);
            return;
        } else if (this.data[mid] < num) {
            left = mid + 1;
        } else {
            right = mid - 1;
        }
    }
    this.data.splice(right + 1, 0, num);
};

MedianFinder.prototype.findMedian = function() {
    const length = this.data.length;
    if (!length) {
        return null;
    }

    const mid = Math.floor((length - 1) / 2);
    if (length % 2) {
        return this.data[mid];
    }
    return (this.data[mid] + this.data[mid + 1]) / 2;
};
```

äºŒåˆ†æŸ¥æ‰¾éœ€è¦$O(logN)$çš„å¤æ‚åº¦ï¼Œç§»åŠ¨å…ƒç´ éœ€è¦$O(N)$å¤æ‚åº¦ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯$O(N)$ã€‚

## è§£æ³• 3: æœ€å¤§å † + æœ€å°å †

å¯¹äºè¿™ç§åŠ¨æ€æ•°æ®ï¼Œå †æ˜¯æå¥½çš„è§£å†³æ–¹æ¡ˆã€‚å‡†å¤‡ä¸¤ä¸ªå †ï¼š

-   æœ€å¤§å †ï¼šå­˜æ”¾æ•°æ®æµä¸­è¾ƒå°çš„ä¸€åŠå…ƒç´ 
-   æœ€å°å †ï¼šå­˜æ”¾æ•°æ®æµä¸­è¾ƒå¤§çš„ä¸€åŠå…ƒç´ 

éœ€è¦ä¿è¯è¿™ 2 ä¸ªå †çš„â€œå¹³è¡¡â€ã€‚è¿™é‡Œçš„å¹³è¡¡æŒ‡å¾—æ˜¯ï¼šæœ€å¤§å †çš„å¤§å° = æœ€å°å †çš„å¤§å°ï¼Œ æˆ–è€… æœ€å¤§å †çš„å¤§å° = æœ€å°å †çš„å¤§å° + 1ã€‚

å½“è°ƒç”¨ findMedian æŸ¥è¯¢ä¸­ä½æ•°çš„æ—¶å€™ï¼Œä¸­ä½æ•°å°±æ˜¯æœ€å¤§å †çš„å †é¡¶å…ƒç´ ï¼Œæˆ–è€… (æœ€å¤§å †çš„å †é¡¶å…ƒç´  + æœ€å°å †çš„å †é¡¶å…ƒç´ )/2

å‰©ä¸‹çš„é—®é¢˜å°±æ˜¯æ€ä¹ˆä¿è¯å †çš„å¹³è¡¡ï¼Ÿæ­¥éª¤å¦‚ä¸‹ï¼š

-   å…ˆè®© num å…¥ maxHeap
-   å–å‡º maxHeap çš„å †é¡¶å…ƒç´ ï¼Œæ”¾å…¥ minHeap
-   è‹¥æ­¤æ—¶`æœ€å¤§å †çš„å¤§å° < æœ€å°å †çš„å¤§å°`ï¼Œå–å‡º minHeap çš„å †é¡¶å…ƒç´ ï¼Œè®©å…¥ maxHeap

ç”±äº JavaScript ä¸­æ²¡æœ‰å †ï¼Œæ‰€ä»¥è¦è‡ªå·±å®ç°ã€‚**åœ¨å®ç°çš„æ—¶å€™ï¼Œå †çš„ä»£ç å…¶å®åªéœ€è¦ä¸€ä»½ï¼Œå †ä¸­è¿›è¡Œåˆ¤å®šçš„æ¯”è¾ƒå‡½æ•°ç”±å¤–ç•Œä¼ å…¥å³å¯**ã€‚è¿™æ˜¯ä¸€ç§åä¸ºã€Œæ¡¥æ¥æ¨¡å¼ã€çš„è®¾è®¡æ¨¡å¼ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š[ã€Šè®¾è®¡æ¨¡å¼ - æ¡¥æ¥æ¨¡å¼ - JavaScriptã€‹](https://xxoo521.com/2019-01-19-bridge-pattern/)

```javascript
// acåœ°å€ï¼šhttps://leetcode-cn.com/problems/find-median-from-data-stream/
// åŸæ–‡åœ°å€ï¼šhttps://xxoo521.com/2020-02-27-find-median-from-data-stream/

const defaultCmp = (x, y) => x > y; // é»˜è®¤æ˜¯æœ€å¤§å †

const swap = (arr, i, j) => ([arr[i], arr[j]] = [arr[j], arr[i]]);

class Heap {
    /**
     * é»˜è®¤æ˜¯æœ€å¤§å †
     * @param {Function} cmp
     */
    constructor(cmp = defaultCmp) {
        this.container = [];
        this.cmp = cmp;
    }

    insert(data) {
        const { container, cmp } = this;

        container.push(data);
        let index = container.length - 1;
        while (index) {
            let parent = Math.floor((index - 1) / 2);
            if (!cmp(container[index], container[parent])) {
                return;
            }
            swap(container, index, parent);
            index = parent;
        }
    }

    extract() {
        const { container, cmp } = this;
        if (!container.length) {
            return null;
        }

        swap(container, 0, container.length - 1);
        const res = container.pop();
        const length = container.length;
        let index = 0,
            exchange = index * 2 + 1;

        while (exchange < length) {
            // // ä»¥æœ€å¤§å †çš„æƒ…å†µæ¥è¯´ï¼šå¦‚æœæœ‰å³èŠ‚ç‚¹ï¼Œå¹¶ä¸”å³èŠ‚ç‚¹çš„å€¼å¤§äºå·¦èŠ‚ç‚¹çš„å€¼
            let right = index * 2 + 2;
            if (right < length && cmp(container[right], container[exchange])) {
                exchange = right;
            }
            if (!cmp(container[exchange], container[index])) {
                break;
            }
            swap(container, exchange, index);
            index = exchange;
            exchange = index * 2 + 1;
        }

        return res;
    }

    top() {
        if (this.container.length) return this.container[0];
        return null;
    }
}
```

æ•´ä½“çš„ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š

```javascript
// acåœ°å€ï¼šhttps://leetcode-cn.com/problems/find-median-from-data-stream/
// åŸæ–‡åœ°å€ï¼šhttps://xxoo521.com/2020-02-27-find-median-from-data-stream/

var MedianFinder = function() {
    this.maxHeap = new Heap();
    this.minHeap = new Heap((x, y) => x < y);
};

MedianFinder.prototype.addNum = function(num) {
    this.maxHeap.insert(num);
    this.minHeap.insert(this.maxHeap.top());
    this.maxHeap.extract();

    if (this.maxHeap.container.length < this.minHeap.container.length) {
        this.maxHeap.insert(this.minHeap.top());
        this.minHeap.extract();
    }
};

MedianFinder.prototype.findMedian = function() {
    return this.maxHeap.container.length > this.minHeap.container.length
        ? this.maxHeap.top()
        : (this.maxHeap.top() + this.minHeap.top()) / 2;
};
```

æ—¶é—´å¤æ‚åº¦æ˜¯$O(logN)$ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯$O(N)$ã€‚

## æ›´å¤šèµ„æ–™

**è‹¥æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚è‹¥å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªã€Œå…³æ³¨+ç‚¹èµã€ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘æ›´æ–°çš„åŠ¨åŠ›** ğŸ‘‡

-   **ğŸ“–Blogï¼š[å‰‘æŒ‡ Offer + Leetcode é¢˜è§£](https://xxoo521.com/algorithm/)**
-   **ğŸ±Github ï¼š[https://github.com/dongyuanxin/blog](https://github.com/dongyuanxin/blog)**
-   **ğŸŒŸ å…¬ä¼—å·ï¼š[å¿ƒè°­åšå®¢](https://tva1.sinaimg.cn/large/006tNbRwly1g9xhhp50jpj31bi0hcju4.jpg)**
